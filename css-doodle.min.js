!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function nth(e,t,r){return e=>e==r}function at(e,t){return(r,n)=>e==r&&t==n}function row(e,t,r){return t=>/^(even|odd)$/.test(t)?is[t](e-1):t==e}function col(e,t,r){return e=>/^(even|odd)$/.test(e)?is[e](t-1):e==t}function even(e,t,r){return e=>is.even(r-1)}function odd(e,t,r){return e=>is.odd(r-1)}function values(e){return Array.isArray(e)?e:Object.keys(e).map(t=>e[t])}function apply_args(e,...t){return t.reduce((e,t)=>e.apply(null,values(t)),e)}function join_line(e){return(e||[]).join("\n")}function make_array(e){return Array.isArray(e)?e:[e]}function minmax(e,t,r){return Math.max(t,Math.min(r,e))}function prefix(e){return`-webkit-${e}${e}`}function only_if(e,t){return e?t:""}function memo(e,t){return function(...r){let n=e+r.join("-");return store[n]?store[n]:store[n]=t.apply(null,r)}}function random(...e){let t=e.reduce((e,t)=>e.concat(t),[]);return t[Math.floor(Math.random()*t.length)]}function range(e,t,r){let n=0,s=e=>e>0&&e<1?.1:1,o=arguments.length;1==o&&([e,t]=[s(e),e]),o<3&&(r=s(e));let i=[];for(;(r>0&&e<t||r<0&&e>t)&&(i.push(e),e+=r,!(n++>=1e3)););return i}function unitify(e){return function(...t){let r=get_unit(t[0]);return r?(t=t.map(remove_unit),add_unit(e,r).apply(null,t)):e.apply(null,t)}}function add_unit(e,t){return function(...r){r=r.map(remove_unit);let n=e.apply(null,r);return t&&(n=n.map(e=>e+t)),n}}function get_unit(e){if(!e)return"";let t=/(%|cm|fr|rem|em|ex|in|mm|pc|pt|px|vh|vw|vmax|vmin|deg|ms|s)$/,r="".trim.call(e).match(t);return r?r[0]:""}function remove_unit(e){let t=get_unit(e);return t?+e.replace(t,""):e}function polygon(e,t){"function"==typeof arguments[0]&&(t=e,e={}),t||(t=(e=>[cos(e),sin(e)]));for(var r=e.split||120,n=e.scale||1,s=DEG*(e.start||0),o=e.deg?e.deg*DEG:PI/(r/2),i=[],a=0;a<r;++a){var u=s+o*a,[c,l]=t(u);i.push(50*c*n+50+"% "+(50*l*n+50)+"%")}return`polygon(${i.join(",")})`}function rotate(e,t,r){var n=DEG*r;return[e*cos(n)-t*sin(n),t*cos(n)+e*sin(n)]}function circle(){return"circle(49%)"}function triangle(){return polygon({split:3,start:-90},e=>[1.1*cos(e),1.1*sin(e)+.2])}function rhombus(){return polygon({split:4})}function pentagon(){return polygon({split:5,start:54})}function hexagon(){return polygon({split:6,start:30})}function heptagon(){return polygon({split:7,start:-90})}function octagon(){return polygon({split:8,start:22.5})}function star(){return polygon({split:5,start:54,deg:144})}function diamond(){return"polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)"}function cross(){return`polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )`}function clover(e=3){return 4==(e=minmax(e,3,5))&&(e=2),polygon({split:240},t=>{var r=cos(e*t)*cos(t),n=cos(e*t)*sin(t);return 3==e&&(r-=.2),2==e&&(r/=1.1,n/=1.1),[r,n]})}function hypocycloid(e=3){var t=1-(e=minmax(e,3,6));return polygon({scale:1/e},r=>{var n=t*cos(r)+cos(t*(r-PI)),s=t*sin(r)+sin(t*(r-PI));return 3==e&&(n=1.1*n-.6,s*=1.1),[n,s]})}function astroid(){return hypocycloid(4)}function infinity(){return polygon(e=>{var t=.7*sqrt(2)*cos(e),r=pow(sin(e),2)+1;return[t/r,t*sin(e)/r]})}function heart(){return polygon(e=>rotate(1.2*(.75*pow(sin(e),3)),1.1*(cos(1*e)*(13/18)-cos(2*e)*(5/18)-cos(3*e)/18-cos(4*e)/18+.2),180))}function bean(){return polygon(e=>{var[t,r]=[pow(sin(e),3),pow(cos(e),3)];return rotate((t+r)*cos(e)*1.3-.45,(t+r)*sin(e)*1.3-.45,-90)})}function bicorn(){return polygon(e=>rotate(cos(e),pow(sin(e),2)/(2+sin(e))-.5,180))}function pear(){return polygon(e=>[sin(e),(1+sin(e))*cos(e)/1.4])}function fish(){return polygon(e=>[cos(e)-pow(sin(e),2)/sqrt(2),sin(2*e)/2])}function whale(){return polygon({split:240},e=>{var t=3.4*(pow(sin(e),2)-.5)*cos(e);return rotate(cos(e)*t+.75,sin(e)*t*1.2,180)})}function bud(e=3){return e=minmax(e,3,10),polygon({split:240},t=>[(1+.2*cos(e*t))*cos(t)*.8,(1+.2*cos(e*t))*sin(t)*.8])}function index(e,t,r){return e=>r}function row$1(e,t,r){return t=>e}function col$1(e,t,r){return e=>t}function any(){return function(...e){return random.apply(null,e)}}function pick(){return any.apply(null,arguments)}function rand(){return function(...e){return random(memo("range",unitify(range)).apply(null,e))}}function shape(e,t,r){return memo("shape",function(e,...t){if(e&&(e=e.trim(),shapes[e]))return shapes[e].apply(null,t)})}function generator(e,t){for(var r=new Rules(e),n=1,s=0;n<=t.x;++n)for(var o=1;o<=t.y;++o)r.compose({x:n,y:o,count:++s});return r.output()}function iterator(e){var t=0,r=1,n=1;return{curr:(r=0)=>e[t+r],end:()=>e.length<=t,info:()=>({index:t,col:r,line:n}),index:e=>void 0===e?t:t=e,next:()=>{var s=e[t++];return"\n"==s?(n++,r=0):r++,s}}}function throw_error(e,{col:t,line:r}){throw new Error(`(at line ${r}, column ${t}) ${e}`)}function get_text_value(e){return e.trim().length?is$1.number(+e)?+e:e.trim():e}function skip_block(e){var[t,r]=[e.curr(),e.curr()],n=is$1.close_bracket_of(r);for(e.next();!e.end();){if(n(r=e.curr())){t+=r;break}is$1.open_bracket(r)?t+=skip_block(e):t+=r,e.next()}return t}function read_word(e,t){for(var r=e.index(),n="";!e.end();){var s=e.next();if(is$1.white_space(s))break;n+=s}return t&&e.index(r),n}function read_step(e){for(var t,r=struct.step();!e.end()&&"}"!=(t=e.curr());)if(is$1.white_space(t))e.next();else{if(r.name.length){if(r.styles.push(read_rule(e)),"}"==e.curr())break}else r.name=read_selector(e);e.next()}return r}function read_steps(e){const t=[];for(var r;!e.end()&&"}"!=(r=e.curr());)is$1.white_space(r)?e.next():(t.push(read_step(e)),e.next());return t}function read_keyframes(e){for(var t,r=struct.keyframes();!e.end()&&"}"!=(t=e.curr());)if(r.name.length){if("{"==t){e.next(),r.steps=read_steps(e);break}e.next()}else if(read_word(e),r.name=read_word(e),"{"==r.name){throw_error("missing keyframes name",e.info());break}return r}function read_comments(e,t={}){var r=struct.comment(),n=e.curr();for("#"!=n&&e.next(),e.next();!e.end()&&("*"!=(n=e.curr())||"/"!=e.curr(1));){if(r.value+=n,n=e.curr(),t.inline){if("\n"==n)return r}else if("*"==n&&"/"==e.curr(1))break;r.value+=n,e.next()}return e.next(),e.next(),r}function read_property(e){for(var t,r="";!e.end()&&":"!=(t=e.curr());)/[a-zA-Z\-]/.test(t)?is$1.white_space(t)||(r+=t):throw_error("Syntax error:Bad property name.",e.info()),e.next();return r}function read_quote_block(e,t){var r,n="";for(e.next();!e.end();){if((r=e.curr())==t){if("\\"!==e.curr(-1))break;n+=r}else n+=r;e.next()}return n}function read_arguments(e){for(var t,r=[],n=[],s="";!e.end();){if(is$1.open_bracket(t=e.curr()))s+=skip_block(e);else if(/['"]/.test(t))s+=read_quote_block(e,t);else if("@"==t)n.length||(s=s.trimLeft()),s.length&&(n.push(struct.text(s)),s=""),n.push(read_func(e));else if(/[,)]/.test(t)){if(s.length&&(n.length?(s=s.trimRight()).length&&n.push(struct.text(s)):n.push(struct.text(get_text_value(s)))),r.push(n.slice()),[n,s]=[[],""],")"==t)break}else s+=t;e.next()}return r}function read_func(e){for(var t,r=struct.func(),n="";!e.end()&&")"!=(t=e.curr());){if("("==t){e.next(),r.name=n,r.arguments=read_arguments(e);break}n+=t,e.next()}return r}function read_value(e){var t,r=struct.text();const n=[];for(;!e.end();)if("\n"!=(t=e.curr())){if(/[;}]/.test(t)){r.value.length&&n.push(r),r=struct.text();break}"@"==t?(r.value.length&&n.push(r),r=struct.text(),n.push(read_func(e))):is$1.white_space(t)&&is$1.white_space(e.curr(-1))||(":"==t&&throw_error("Syntax error:Bad property name.",e.info()),r.value+=t),e.next()}else e.next();return r.value.length&&n.push(r),n.length&&n[0].value&&(n[0].value=n[0].value.trimLeft()),n}function read_selector(e){for(var t,r="";!e.end()&&"{"!=(t=e.curr());)is$1.white_space(t)||(r+=t),e.next();return r}function read_cond_selector(e){for(var t,r={name:"",arguments:[]};!e.end();){if("("==(t=e.curr()))e.next(),r.arguments=read_arguments(e);else{if(/[){]/.test(t))break;is$1.white_space(t)||(r.name+=t)}e.next()}return r}function read_psuedo(e){for(var t,r=struct.psuedo();!e.end()&&"}"!=(t=e.curr());)if(is$1.white_space(t))e.next();else{if(r.selector){if(r.styles.push(read_rule(e)),"}"==e.curr())break}else r.selector=read_selector(e);e.next()}return r}function read_rule(e){for(var t=struct.rule();!e.end()&&";"!=e.curr();){if(t.property.length){t.value=read_value(e);break}t.property=read_property(e),e.next()}return t}function read_cond(e){for(var t,r=struct.cond();!e.end()&&"}"!=(t=e.curr());){if(r.name.length){if(":"==t){var n=read_psuedo(e);n.selector&&r.styles.push(n)}else if("@"==t)r.styles.push(read_cond(e));else if(!is$1.white_space(t)){var s=read_rule(e);if(s.property&&r.styles.push(s),"}"==e.curr())break}}else Object.assign(r,read_cond_selector(e));e.next()}return r}function tokenizer(e){const t=iterator(e),r=[];for(;!t.end();){var n=t.curr();if(is$1.white_space(n))t.next();else{if("/"==n&&"*"==t.curr(1))r.push(read_comments(t));else if("#"==n||"/"==n&&"/"==t.curr(1))r.push(read_comments(t,{inline:!0}));else if(":"==n){var s=read_psuedo(t);s.selector&&r.push(s)}else if("@"==n)if("@keyframes"===read_word(t,!0)){var o=read_keyframes(t);r.push(o)}else{var i=read_cond(t);i.name.length&&r.push(i)}else if(!is$1.white_space(n)){var a=read_rule(t);a.property&&r.push(a)}t.next()}}return r}function compile(e,t){return generator(tokenizer(e),t)}function parse_size(e){let[t,r]=(e+"").replace(/\s+/g,"").replace(/[,，xX]+/,"x").split("x").map(Number);const n={x:minmax(t||MIN,1,MAX),y:minmax(r||t||MIN,1,MAX)};return Object.assign({},n,{count:n.x*n.y})}const is={even:e=>!!(e%2),odd:e=>!(e%2)};var cond={nth:nth,at:at,row:row,col:col,even:even,odd:odd};const store={},{cos:cos,sin:sin,sqrt:sqrt,pow:pow,PI:PI}=Math,DEG=PI/180;var shapes={circle:circle,triangle:triangle,rhombus:rhombus,pentagon:pentagon,hexagon:hexagon,heptagon:heptagon,octagon:octagon,star:star,diamond:diamond,cross:cross,clover:clover,hypocycloid:hypocycloid,astroid:astroid,infinity:infinity,heart:heart,bean:bean,bicorn:bicorn,pear:pear,fish:fish,whale:whale,bud:bud},func={index:index,row:row$1,col:col$1,any:any,pick:pick,rand:rand,shape:shape},math=Object.getOwnPropertyNames(Math).reduce((expose,n)=>(expose[n]=function(){return function(...args){return"number"==typeof Math[n]?Math[n]:Math[n].apply(null,args.map(eval))}},expose),{});const reg_size=/[,，\/\s]+\s*/;var shortcuts={["size"](e){var[t,r=t]=e.split(reg_size);return`width:${t};height:${r};`},["min-size"](e){var[t,r=t]=e.split(reg_size);return`min-width:${t};min-height:${r};`},["max-size"](e){var[t,r=t]=e.split(reg_size);return`max-width:${t};max-height:${r};`}};class Rules{constructor(e){this.tokens=e,this.rules={},this.props={},this.keyframes={},this.styles={host:"",cells:"",keyframes:""}}add_rule(e,t){var r=this.rules[e];r||(r=this.rules[e]=[]),r.push.apply(r,make_array(t))}pick_func(e){return func[e]||math[e]}compose_aname(...e){return e.join("-")}compose_selector(e,t=""){return`.cell:nth-of-type(${e})${t}`}compose_argument(e,t){var r=e.map(e=>{if("text"==e.type)return e.value;if("func"==e.type){var r=this.pick_func(e.name.substr(1));if(r){var n=e.arguments.map(e=>this.compose_argument(e,t));return apply_args(r,t,n)}}});return r.length>2?r.join(""):r[0]}compose_value(e,t){return e.reduce((e,r)=>{switch(r.type){case"text":e+=r.value;break;case"func":var n=this.pick_func(r.name.substr(1));if(n){var s=r.arguments.map(e=>this.compose_argument(e,t));e+=apply_args(n,t,s)}}return e},"")}compose_rule(e,t){var r=e.property,n=this.compose_value(e.value,t),s=`${r}:${n};`;if("transition"==r&&(this.props.has_transition=!0),"clip-path"==r&&(s=prefix(s),s+=";overflow:hidden;"),/^animation(\-name)?$/.test(r)&&(this.props.has_animation=!0,t.count>1)){var{count:o}=t;switch(r){case"animation-name":s=`${r}:${this.compose_aname(n,o)};`;break;case"animation":var i=(n||"").split(/\s+/);i[0]=this.compose_aname(i[0],o),s=`${r}:${i.join(" ")};`}}return shortcuts[r]&&(s=shortcuts[r](n)),s}compose(e,t){(t||this.tokens).forEach((t,r)=>{if(t.skip)return!1;switch(t.type){case"rule":this.add_rule(this.compose_selector(e.count),this.compose_rule(t,e));break;case"psuedo":t.selector.startsWith(":doodle")&&(t.selector=t.selector.replace(/^\:+doodle/,":host"));var n=t.selector.startsWith(":host");n&&(t.skip=!0);var s=t.styles.map(t=>this.compose_rule(t,e)),o=n?t.selector:this.compose_selector(e.count,t.selector);this.add_rule(o,s);break;case"cond":var i=cond[t.name.substr(1)];if(i){var a=t.arguments.map(t=>this.compose_argument(t,e));apply_args(i,e,a)&&this.compose(e,t.styles)}break;case"keyframes":if(this.keyframes[t.name])return!1;this.keyframes[t.name]=(()=>`\n ${join_line(t.steps.map(t=>`\n ${t.name}{${join_line(t.styles.map(t=>this.compose_rule(t,e)))}}`))}`)}})}output(){return Object.keys(this.rules).forEach((e,t)=>{var r=e.startsWith(":host")?"host":"cells";this.styles[r]+=`\n ${e}{${join_line(this.rules[e])}}`,Object.keys(this.keyframes).forEach(e=>{var r=this.compose_aname(e,t+1);this.styles.keyframes+=`\n ${only_if(0==t,`@keyframes ${e}{${this.keyframes[e]()}}`)}@keyframes ${r}{${this.keyframes[e]()}}`})}),{props:this.props,styles:this.styles}}}const struct={func:(e="")=>({type:"func",name:e,arguments:[]}),argument:()=>({type:"argument",value:[]}),text:(e="")=>({type:"text",value:e}),comment:e=>({type:"comment",value:e}),psuedo:(e="")=>({type:"psuedo",selector:e,styles:[]}),cond:(e="")=>({type:"cond",name:e,styles:[],arguments:[]}),rule:(e="")=>({type:"rule",property:e,value:[]}),keyframes:(e="")=>({type:"keyframes",name:e,steps:[]}),step:(e="")=>({type:"step",name:e,styles:[]})},bracket_pair={"(":")","[":"]","{":"}"},is$1={white_space:e=>/[\s\n\t]/.test(e),open_bracket:e=>bracket_pair.hasOwnProperty(e),close_bracket_of(e){var t=bracket_pair[e];return e=>e==t},number:e=>!isNaN(e)},MIN=1,MAX=16,basic=`\n:host{display:block;visibility:visible;width:1em;height:1em;}.container{position:relative;width:100%;height:100%;display:grid;}.cell{position:relative;line-height:1;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}`;class Doodle extends HTMLElement{constructor(){super(),this.doodle=this.attachShadow({mode:"open"})}connectedCallback(){setTimeout(()=>{if(!this.innerHTML.trim())return!1;let e;try{e=compile(this.innerHTML,this.size=parse_size(this.getAttribute("grid")))}catch(e){throw this.innerHTML="",new Error(e)}const{has_transition:t,has_animation:r}=e.props;this.doodle.innerHTML=`\n<style>${basic}</style><style class="style-keyframes">${e.styles.keyframes}</style><style class="style-container">${this.style_size()}${e.styles.host}</style><style class="style-cells">${t||r?"":e.styles.cells}</style><div class="container">${this.html_cells()}</div>`,(t||r)&&setTimeout(()=>{this.set_style(".style-cells",e.styles.cells)},50)})}style_size(){return`\n .container{grid-template-rows:repeat(${this.size.x}, 1fr);grid-template-columns:repeat(${this.size.y}, 1fr);}`}html_cells(){return'<div class="cell"></div>'.repeat(this.size.count)}set_style(e,t){const r=this.shadowRoot.querySelector(e);r&&(r.styleSheet?r.styleSheet.cssText=t:r.innerHTML=t)}update(e){if(!e)return!1;this.size||(this.size=parse_size(this.getAttribute("grid")));const t=compile(e,this.size);this.set_style(".style-keyframes",t.styles.keyframes),this.set_style(".style-container",this.style_size()+t.styles.host),this.set_style(".style-cells",t.styles.cells),this.innerHTML=e}refresh(){this.update(this.innerHTML)}get grid(){return Object.assign({},this.size)}set grid(e){this.setAttribute("grid",e),this.connectedCallback()}static get observedAttributes(){return["grid"]}attributeChangedCallback(e,t,r){"grid"==e&&t&&t!==r&&(this.grid=r)}}customElements.define("css-doodle",Doodle)});