!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(e){let t=0,n=1,r=1;return{curr:(n=0)=>e[t+n],end:()=>e.length<=t,info:()=>({index:t,col:n,line:r}),index:e=>void 0===e?t:t=e,next(){let i=e[t++];return"\n"==i?(r++,n=0):n++,i}}}function t(t){t=t.trim();let n=[];if(!/^var\(/.test(t))return n;let r=e(t);try{n=function(e){let t="",n=[],r=[],i={};for(;!e.end();){let l=e.curr();if("("==l)n.push(l),t="";else if(")"==l||","==l){if(/^\-\-.+/.test(t)&&(i.name?(i.alternative||(i.alternative=[]),i.alternative.push({name:t})):i.name=t),")"==l){if("("!=n[n.length-1])throw new Error("bad match");n.pop()}","==l&&(n.length||(r.push(i),i={})),t=""}else/\s/.test(l)||(t+=l);e.next()}return n.length?[]:(i.name&&r.push(i),r)}(r)}catch(e){console.error(e&&e.message||"Bad variables.")}return n}function n(e){return Array.isArray(e)?e:[e]}function r(e,t="\n"){return(e||[]).join(t)}function i(e){return e[e.length-1]}function l(e){return e[0]}function s(e,t){return Array.prototype.flatMap?e.flatMap(t):e.reduce((e,n)=>e.concat(t(n)),[])}const h={func:(e="")=>({type:"func",name:e,arguments:[]}),argument:()=>({type:"argument",value:[]}),text:(e="")=>({type:"text",value:e}),pseudo:(e="")=>({type:"pseudo",selector:e,styles:[]}),cond:(e="")=>({type:"cond",name:e,styles:[],arguments:[]}),rule:(e="")=>({type:"rule",property:e,value:[]}),keyframes:(e="")=>({type:"keyframes",name:e,steps:[]}),step:(e="")=>({type:"step",name:e,styles:[]})},o={white_space:e=>/[\s\n\t]/.test(e),line_break:e=>/\n/.test(e),number:e=>!isNaN(e),pair:e=>['"',"(",")","'"].includes(e),pair_of:(e,t)=>({'"':'"',"'":"'","(":")"})[e]==t};function u(e,{col:t,line:n}){console.error(`(at line ${n}, column ${t}) ${e}`)}function f(e){return function(t,n){let r=t.index(),i="";for(;!t.end();){let n=t.next();if(e(n))break;i+=n}return n&&t.index(r),i}}function p(e,t){return f(e=>/[^\w@]/.test(e))(e,t)}function a(e){return f(e=>/[\s\{]/.test(e))(e)}function g(e,t){return f(e=>o.line_break(e)||"{"==e)(e,t)}function c(e,t){let n,r=h.step();for(;!e.end()&&"}"!=(n=e.curr());)if(o.white_space(n))e.next();else{if(r.name.length){if(r.styles.push(M(e,t)),"}"==e.curr())break}else r.name=z(e);e.next()}return r}function y(e,t){const n=[];let r;for(;!e.end()&&"}"!=(r=e.curr());)o.white_space(r)?e.next():(n.push(c(e,t)),e.next());return n}function m(e,t){let n,r=h.keyframes();for(;!e.end()&&"}"!=(n=e.curr());)if(r.name.length){if("{"==n){e.next(),r.steps=y(e,t);break}e.next()}else if(p(e),r.name=a(e),!r.name.length){u("missing keyframes name",e.info());break}return r}function b(e,t={}){for(e.next();!e.end();){let n=e.curr();if(t.inline){if("\n"==n)break}else if("*"==(n=e.curr())&&"/"==e.curr(1))break;e.next()}t.inline||(e.next(),e.next())}function d(e){let t,n="";for(;!e.end()&&":"!=(t=e.curr());)o.white_space(t)||(n+=t),e.next();return n}function $(e){let t,n=[],r=[],l=[],s="";for(;!e.end();){if(t=e.curr(),/[\('"`]/.test(t)&&"\\"!==e.curr(-1))l.length&&"("!=t&&t===i(l)?l.pop():l.push(t),s+=t;else if("@"==t)r.length||(s=s.trimLeft()),s.length&&(r.push(h.text(s)),s=""),r.push(_(e));else if(/[,)]/.test(t)){if(l.length)")"==t&&l.pop(),s+=t;else if(s.length&&(r.length?s.length&&r.push(h.text(s)):r.push(h.text((u=s).trim().length?o.number(+u)?+u:u.trim():u))),n.push(v(r)),[r,s]=[[],""],")"==t)break}else s+=t;e.next()}var u;return n}function v(e){let t=e.map(e=>{if("text"==e.type&&"string"==typeof e.value){let t=String(e.value);t.includes("`")&&(e.value=t=t.replace(/`/g,'"')),e.value=t.replace(/\n+|\s+/g," ")}return e}),n=l(t)||{},r=i(t)||{};if("text"==n.type&&"text"==r.type){let e=l(n.value),t=i(r.value);"string"==typeof n.value&&"string"==typeof r.value&&o.pair(e)&&o.pair_of(e,t)&&(n.value=n.value.slice(1),r.value=r.value.slice(0,r.value.length-1))}return t}function _(e){let t,n=h.func(),r="";for(;!e.end()&&")"!=(t=e.curr());){if("("==t){e.next(),n.name=r,n.arguments=$(e),n.position=e.info().index;break}r+=t,e.next()}return n}function w(e){let t,n=h.text(),r=0,i=!0;const l=[],s=[];for(l[r]=[];!e.end();)if(t=e.curr(),i&&o.white_space(t))e.next();else{if(i=!1,"\n"!=t||o.white_space(e.curr(-1)))if(","!=t||s.length){if(/[;}]/.test(t)){n.value.length&&(l[r].push(n),n=h.text());break}"@"==t?(n.value.length&&(l[r].push(n),n=h.text()),l[r].push(_(e))):o.white_space(t)&&o.white_space(e.curr(-1))||("("==t&&s.push(t),")"==t&&s.pop(),n.value+=t)}else n.value.length&&(l[r].push(n),n=h.text()),l[++r]=[],i=!0;else n.value+=" ";e.next()}return n.value.length&&l[r].push(n),l}function z(e){let t,n="";for(;!e.end()&&"{"!=(t=e.curr());)o.white_space(t)||(n+=t),e.next();return n}function j(e){let t,n={name:"",arguments:[]};for(;!e.end();){if("("==(t=e.curr()))e.next(),n.arguments=$(e);else{if(/[){]/.test(t))break;o.white_space(t)||(n.name+=t)}e.next()}return n}function A(e,t){let n,r=h.pseudo();for(;!e.end()&&"}"!=(n=e.curr());)if(o.white_space(n))e.next();else{if(r.selector){let n=M(e,t);if("@use"==n.property?r.styles=r.styles.concat(n.value):r.styles.push(n),"}"==e.curr())break}else r.selector=z(e);e.next()}return r}function M(e,t){let n,r=h.rule();for(;!e.end()&&";"!=(n=e.curr());){if(r.property.length){r.value=w(e);break}if(r.property=d(e),"@use"==r.property){r.value=C(e,t);break}e.next()}return r}function S(e,t){let n,r=h.cond();for(;!e.end()&&"}"!=(n=e.curr());){if(r.name.length)if(":"==n){let t=A(e);t.selector&&r.styles.push(t)}else if("@"!=n||g(e,!0).includes(":")){if(!o.white_space(n)){let n=M(e,t);if(n.property&&r.styles.push(n),"}"==e.curr())break}}else r.styles.push(S(e));else Object.assign(r,j(e));e.next()}return r}function E(e,t){let n="";return e&&e.get_custom_property_value&&(n=e.get_custom_property_value(t)),n}function C(e,n){return e.next(),(w(e)||[]).reduce((e,r)=>{!function e(n,r){n.forEach&&n.forEach(n=>{if("text"==n.type&&n.value){let e=t(n.value);n.value=e.reduce((e,t)=>{let n,i="",l="";!(i=E(r,t.name))&&t.alternative&&t.alternative.every(e=>{if(l=E(r,e.name))return i=l,!1});try{n=O(i,r)}catch(e){}return n&&e.push.apply(e,n),e},[])}"func"==n.type&&n.arguments&&n.arguments.forEach(t=>{e(t,r)})})}(r,n);let[i]=r;return i.value&&i.value.length&&e.push(...i.value),e},[])}function O(t,n){const r=e(t),i=[];for(;!r.end();){let e=r.curr();if(o.white_space(e))r.next();else{if("/"==e&&"*"==r.curr(1))b(r);else if("/"==e&&"/"==r.curr(1))b(r,{inline:!0});else if(":"==e){let e=A(r,n);e.selector&&i.push(e)}else if("@"==e&&"@keyframes"===p(r,!0)){let e=m(r,n);i.push(e)}else if("@"!=e||g(r,!0).includes(":")){if(!o.white_space(e)){let e=M(r,n);e.property&&i.push(e)}}else{let e=S(r,n);e.name.length&&i.push(e)}r.next()}}return i}function L(e,...t){return t.reduce((e,t)=>e.apply(null,n(t)),e)}function H(e,t,n){return Math.max(t,Math.min(n,e))}function N(e,t,n){let r=0,i=e,l=e=>e>0&&e<1?.1:1,s=arguments.length;1==s&&([e,t]=[l(e),e]),s<3&&(n=l(e));let h=[];for(;(n>=0&&e<=t||n<0&&e>t)&&(h.push(e),e+=n,!(r++>=1e3)););return h.length||h.push(i),h}function W(e){return/^[a-zA-Z]$/.test(e)}function R(e){let t=()=>e;return t.lazy=!0,t}const[I,P,U]=[1,32,1024];function q(e){let[t,n]=(e+"").replace(/\s+/g,"").replace(/[,，xX]+/,"x").split("x").map(Number);const r=1==t||1==n?U:P,i={x:H(t||I,1,r),y:H(n||t||I,1,r)};return Object.assign({},i,{count:i.x*i.y})}function B(e,t){if(t){let n=new Blob([e],{type:"image/svg+xml"});return`url(${URL.createObjectURL(n)}#${t})`}return`url("data:image/svg+xml;utf8,${encodeURIComponent(e)}")`}function D(e){const t='xmlns="http://www.w3.org/2000/svg"';return e.includes("<svg")||(e=`<svg ${t}>${e}</svg>`),e.includes("xmlns")||(e=e.replace(/<svg([\s>])/,`<svg ${t}$1`)),e}function Z(e=0,t=e){return 1==arguments.length&&(e=e<1?.1:1),function(e,t,n){return e*(1-n)+t*n}(e,t,Math.random())}function V(e){return(...t)=>{let n=function(e){let t="";return e.some(e=>{let n=String(e).trim();if(!n)return"";let r=n.match(/\d(\D+)$/);return t=r?r[1]:""}),t}(t);return function(e,t){return(...n)=>{n=n.map(e=>Number(String(e).replace(/\D+$/g,"")));let r=e.apply(null,n);return t.length?Array.isArray(r)?r.map(e=>e+t):r+t:r}}(e,n).apply(null,t)}}function X(e){return(...t)=>{let n=t.map(e=>String(e).charCodeAt(0)),r=e.apply(null,n);return Array.isArray(r)?r.map(e=>String.fromCharCode(e)):String.fromCharCode(r)}}function F(e){const t=function(e){let t=function(e){let t=String(e),n=[],r="";for(let e=0;e<t.length;++e){let l=t[e];if(G[l])if("-"==l&&"e"==t[e-1])r+=l;else if(n.length||r.length||!/[+-]/.test(l)){let{type:e,value:t}=i(n)||{};"operator"==e&&!r.length&&/[^()]/.test(l)&&/[^()]/.test(t)?r+=l:(r.length&&(n.push({type:"number",value:r}),r=""),n.push({type:"operator",value:l}))}else r+=l;else/\S/.test(l)&&(r+=l)}r.length&&n.push({type:"number",value:r});return n}(e);const n=[],r=[];for(let e=0;e<t.length;++e){let{type:l,value:s}=t[e];if("number"==l)r.push(s);else if("operator"==l)if("("==s)n.push(s);else if(")"==s){for(;n.length&&"("!=i(n);)r.push(n.pop());n.pop()}else{for(;n.length&&G[i(n)]>=G[s];){let e=n.pop();/[()]/.test(e)||r.push(e)}n.push(s)}}for(;n.length;)r.push(n.pop());return r}(e),n=[];for(;t.length;){let e=t.shift();if(/\d+/.test(e))n.push(e);else{let t=n.pop(),r=n.pop();n.push(J(e,Number(r),Number(t)))}}return n[0]}const G={"*":3,"/":3,"%":3,"+":2,"-":2,"(":1,")":1};function J(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n}}const K={};function Q(e,t){return(...n)=>{let r=e+n.join("-");return K[r]?K[r]:K[r]=t.apply(null,n)}}function Y(e){return(...t)=>e.apply(null,s(t,e=>String(e).startsWith("[")?T(e):e))}function x(e,t){return{type:e,value:t}}const T=Q("build_range",e=>{return s(function(e){let t=String(e),n=[],r=[];if(!t.startsWith("[")||!t.endsWith("]"))return n;for(let e=1;e<t.length-1;++e){let l=t[e];if("-"!=l||"-"!=t[e-1])if("-"!=l)if("-"!=i(r))r.length&&n.push(x("char",r.pop())),r.push(l);else{r.pop();let e=r.pop();n.push(e?x("range",[e,l]):x("char",l))}else r.push(l)}return r.length&&n.push(x("char",r.pop())),n}(e),({type:e,value:t})=>{if("char"==e)return t;let[n,r]=t,i=!1;n>r&&([n,r]=[r,n],i=!0);let l=X(N)(n,r);return i&&l.reverse(),l})}),k={index:({count:e})=>t=>e,row:({x:e})=>t=>e,col:({y:e})=>t=>e,size:({grid:e})=>t=>e.count,"size-row":({grid:e})=>t=>e.x,"size-col":({grid:e})=>t=>e.y,n:({idx:e})=>t=>e||0,pick:({context:e})=>Y((...t)=>e.last_pick=function(...e){let t=e.reduce((e,t)=>e.concat(t),[]);return t[~~(Math.random()*t.length)]}(t)),"pick-n"({idx:e,context:t,position:n}){let r="pn-counter"+n;return Y((...n)=>{t[r]||(t[r]=0),t[r]+=1;let i=n.length,l=((null==e?t[r]:e)-1)%i;return t.last_pick=n[l]})},"pick-d"({idx:e,context:t,position:n}){let r="pd-counter"+n,i="pd-values"+n;return Y((...n)=>{t[r]||(t[r]=0),t[r]+=1,t[i]||(t[i]=function(e){let t=Array.from?Array.from(e):e.slice(),n=e.length;for(;n;){let e=~~(Math.random()*n--),r=t[n];t[n]=t[e],t[e]=r}return t}(n));let l=n.length,s=((null==e?t[r]:e)-1)%l;return t.last_pick=t[i][s]})},"last-pick":({context:e})=>()=>e.last_pick,multiple:R((e,t)=>{let n=[];if(!t||!e)return n;let r=H(e(),1,65536);for(let e=0;e<r;++e)n.push(t(e+1));return n.join(",")}),repeat:R((e,t)=>{let n="";if(!t||!e)return n;let r=H(e(),1,65536);for(let e=0;e<r;++e)n+=t(e+1);return n}),rand:({context:e})=>(...t)=>{let n=(t.every(W)?X:V)(Z).apply(null,t);return e.last_rand=n},"last-rand":({context:e})=>()=>e.last_rand,calc:()=>e=>F(e),hex:()=>e=>parseInt(e).toString(16),svg:R(e=>{if(void 0===e)return"";return B(D(e().trim()))}),"svg-filter":R(e=>{if(void 0===e)return"";let t=function(e=""){return e+Math.random().toString(32).substr(2)}("filter-");return B(D(e().trim()).replace(/<filter([\s>])/,`<filter id="${t}"$1`),t)}),var:()=>e=>`var(${e})`};var ee,te,ne=(ee=k,te={multi:"multiple",m:"multiple",pn:"pick-n",pd:"pick-d",r:"rand",p:"pick",lp:"last-pick",lr:"last-rand",i:"index","pick-by-turn":"pick-n","max-row":"size-row","max-col":"size-col"},Object.keys(te).forEach(e=>{ee[e]=ee[te[e]]}),ee);const re=e=>/[,，\s]/.test(e);function ie(e){for(;!e.end()&&re(e.curr(1));)e.next()}function le(t){const n=e(t),r=[],i=[];let l="";for(;!n.end();){let e=n.curr();"("==e?(l+=e,i.push(e)):")"==e?(l+=e,i.length&&i.pop()):i.length?l+=e:re(e)?(r.push(l),l="",ie(n)):l+=e,n.next()}return l&&r.push(l),r}const{cos:se,sin:he,sqrt:oe,pow:ue,PI:fe}=Math,pe=fe/180;function ae(e,t){"function"==typeof arguments[0]&&(t=e,e={}),t||(t=(e=>[se(e),he(e)]));let n=e.split||120,r=e.scale||1,i=pe*(e.start||0),l=e.deg?e.deg*pe:fe/(n/2),s=[];for(let e=0;e<n;++e){let n=i+l*e,[h,o]=t(n);s.push(50*h*r+50+"% "+(50*o*r+50)+"%")}return e.type?`polygon(${e.type}, ${s.join(",")})`:`polygon(${s.join(",")})`}function ge(e,t,n){let r=pe*n;return[e*se(r)-t*he(r),t*se(r)+e*he(r)]}const ce={circle:()=>"circle(49%)",triangle:()=>ae({split:3,start:-90},e=>[1.1*se(e),1.1*he(e)+.2]),rhombus:()=>ae({split:4}),pentagon:()=>ae({split:5,start:54}),hexgon:()=>ae({split:6,start:30}),hexagon:()=>ae({split:6,start:30}),heptagon:()=>ae({split:7,start:-90}),octagon:()=>ae({split:8,start:22.5}),star:()=>ae({split:5,start:54,deg:144}),diamond:()=>"polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)",cross:()=>"polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )",clover:(e=3)=>(4==(e=H(e,3,5))&&(e=2),ae({split:240},t=>{let n=se(e*t)*se(t),r=se(e*t)*he(t);return 3==e&&(n-=.2),2==e&&(n/=1.1,r/=1.1),[n,r]})),hypocycloid(e=3){let t=1-(e=H(e,3,6));return ae({scale:1/e},n=>{let r=t*se(n)+se(t*(n-fe)),i=t*he(n)+he(t*(n-fe));return 3==e&&(r=1.1*r-.6,i*=1.1),[r,i]})},astroid:()=>ce.hypocycloid(4),infinity:()=>ae(e=>{let t=.7*oe(2)*se(e),n=ue(he(e),2)+1;return[t/n,t*he(e)/n]}),heart:()=>ae(e=>{return ge(1.2*(.75*ue(he(e),3)),1.1*(se(1*e)*(13/18)-se(2*e)*(5/18)-se(3*e)/18-se(4*e)/18+.2),180)}),bean:()=>ae(e=>{let[t,n]=[ue(he(e),3),ue(se(e),3)];return ge((t+n)*se(e)*1.3-.45,(t+n)*he(e)*1.3-.45,-90)}),bicorn:()=>ae(e=>ge(se(e),ue(he(e),2)/(2+he(e))-.5,180)),pear:()=>ae(e=>[he(e),(1+he(e))*se(e)/1.4]),fish:()=>ae(e=>[se(e)-ue(he(e),2)/oe(2),he(2*e)/2]),whale:()=>ae({split:240},e=>{let t=3.4*(ue(he(e),2)-.5)*se(e);return ge(se(e)*t+.75,he(e)*t*1.2,180)}),bud:(e=3)=>(e=H(e,3,10),ae({split:240},t=>[(1+.2*se(e*t))*se(t)*.8,(1+.2*se(e*t))*he(t)*.8])),alien(...e){let[t=1,n=1,r=1,i=1,l=1]=e.map(e=>H(e,1,9));return ae({split:480,type:"evenodd"},e=>[.31*(se(e*t)+se(e*r)+se(e*l)),.31*(he(e*n)+he(e*i)+he(e))])}};let ye=[];function me(e){if(!ye.length){let e=new Set;for(let t in document.head.style)t.startsWith("-")||e.add(t.replace(/[A-Z]/g,"-$&").toLowerCase());e.has("grid-gap")||e.add("grid-gap"),ye=Array.from(e)}return e&&e.test?ye.filter(t=>e.test(t)):ye}function be(e){let t=new RegExp(`\\-?${e}\\-?`);return me(t).map(e=>e.replace(t,"")).reduce((e,t)=>(e[t]=t,e),{})}const de=be("webkit"),$e=be("moz");function ve(e,t){return de[e]?`-webkit-${t}${t}`:$e[e]?`-moz-${t}${t}`:t}var _e={"@size"(e,{is_special_selector:t}){let[n,r=n]=le(e);return`\n width:${n};height:${r};${t?"":`\n --internal-cell-width:${n};--internal-cell-height:${r};`}`},"@min-size"(e){let[t,n=t]=le(e);return`min-width:${t};min-height:${n};`},"@max-size"(e){let[t,n=t]=le(e);return`max-width:${t};max-height:${n};`},"@place-cell":(()=>{let e={center:"50%",0:"0%",left:"0%",right:"100%",top:"50%",bottom:"50%"},t={center:"50%",0:"0%",top:"0%",bottom:"100%",left:"50%",right:"50%"};return n=>{let[r,i="50%"]=le(n);const l="var(--internal-cell-width, 25%)",s="var(--internal-cell-height, 25%)";return`\n position:absolute;left:${r=e[r]||r};top:${i=t[i]||i};width:${l};height:${s};margin-left:calc(${l}/ -2) !important;margin-top:calc(${s}/ -2) !important;grid-area:unset !important;`}})(),"@grid"(e,t){let[n,r]=e.split("/").map(e=>e.trim());return{grid:q(n),size:r?this["@size"](r,t):""}},"@shape":Q("shape-property",e=>{let[t,...n]=le(e);return ce[t]?ve("clip-path",`clip-path:${ce[t].apply(null,n)};`)+"overflow:hidden;":""}),"@use"(e){if(e.length>2)return e}};function we(e,t,n){let r=function(e){return t=>String(e).replace(/(\d+)(n)/g,"$1*"+t).replace(/n/g,t)}(e);for(let e=0;e<=n;++e)if(F(r(e))==t)return!0}const ze={even:e=>!!(e%2),odd:e=>!(e%2)};function je(e){return/^(even|odd)$/.test(e)}var Ae={at:({x:e,y:t})=>(n,r)=>e==n&&t==r,nth:({count:e,grid:t})=>(...n)=>n.some(n=>je(n)?ze[n](e-1):we(n,e,t.count)),row:({x:e,grid:t})=>(...n)=>n.some(n=>je(n)?ze[n](e-1):we(n,e,t.x)),col:({y:e,grid:t})=>(...n)=>n.some(n=>je(n)?ze[n](e-1):we(n,e,t.y)),even:({count:e})=>t=>ze.even(e-1),odd:({count:e})=>t=>ze.odd(e-1),random:()=>(e=.5)=>(e>=1&&e<=0&&(e=.5),Math.random()<e)};var Me=Object.getOwnPropertyNames(Math).reduce((e,t)=>(e[t]=(()=>(...e)=>"number"==typeof Math[t]?Math[t]:Math[t].apply(null,e.map(F))),e),{});function Se(e){return/^\:(host|doodle)/.test(e)}function Ee(e){return/^\:(container|parent)/.test(e)}function Ce(e){return Se(e)||Ee(e)}class Oe{constructor(e){this.tokens=e,this.rules={},this.props={},this.keyframes={},this.grid=null,this.coords=[],this.reset()}reset(){this.styles={host:"",container:"",cells:"",keyframes:""},this.coords=[];for(let e in this.rules)e.startsWith(".cell")&&delete this.rules[e]}add_rule(e,t){let r=this.rules[e];r||(r=this.rules[e]=[]),r.push.apply(r,n(t))}pick_func(e){return ne[e]||Me[e]}compose_aname(...e){return e.join("-")}compose_selector(e,t=""){return`.cell:nth-of-type(${e})${t}`}compose_argument(e,t,n){let r=e.map(e=>{if("text"==e.type)return e.value;if("func"==e.type){let r=this.pick_func(e.name.substr(1));if(r){t.idx=n,t.position=e.position;let i=e.arguments.map(e=>r.lazy?n=>this.compose_argument(e,t,n):this.compose_argument(e,t,n));return L(r,t,i)}}});return r.length>=2?r.join(""):r[0]}compose_value(e,t){return e&&e.reduce?e.reduce((e,n)=>{switch(n.type){case"text":e+=n.value;break;case"func":{let r=n.name.substr(1),i=this.pick_func(r);if(i){t.position=n.position;let r=n.arguments.map(e=>i.lazy?n=>this.compose_argument(e,t,n):this.compose_argument(e,t));e+=L(i,t,r)}}}return e},""):""}compose_rule(e,t,n){let r=Object.assign({},t),i=e.property,l=e.value.map(e=>this.compose_value(e,r)),s=l.join(", ");if(/^animation(\-name)?$/.test(i)&&(this.props.has_animation=!0,r.count>1)){let{count:e}=r;switch(i){case"animation-name":s=l.map(t=>this.compose_aname(t,e)).join(", ");break;case"animation":s=l.map(t=>{let n=(t||"").split(/\s+/);return n[0]=this.compose_aname(n[0],e),n.join(" ")}).join(", ")}}"content"==i&&(/["']|^(none|var|counter|counters|attr)\(/.test(s)||(s=`'${s}'`)),"transition"==i&&(this.props.has_transition=!0);let h=`${i}:${s};`;if(h=ve(i,h),"clip-path"==i&&(h+=";overflow:hidden;"),"width"!=i&&"height"!=i||Ce(n)||(h+=`--internal-cell-${i}:${s};`),_e[i]){let t=_e[i](s,{is_special_selector:Ce(n)});switch(i){case"@grid":Se(n)&&(this.grid=t.grid,h=t.size||"");break;case"@place-cell":Se(n)||(h=t);case"@use":e.value.length&&this.compose(r,e.value),h=_e[i](e.value);default:h=t}}return h}compose(e,t){this.coords.push(e),(t||this.tokens).forEach((t,n)=>{if(t.skip)return!1;switch(t.type){case"rule":this.add_rule(this.compose_selector(e.count),this.compose_rule(t,e));break;case"pseudo":{t.selector.startsWith(":doodle")&&(t.selector=t.selector.replace(/^\:+doodle/,":host"));let n=Ce(t.selector);n&&(t.skip=!0),t.selector.split(",").forEach(r=>{let i=t.styles.map(t=>this.compose_rule(t,e,r)),l=n?r:this.compose_selector(e.count,r);this.add_rule(l,i)});break}case"cond":{let n=Ae[t.name.substr(1)];if(n){let r=t.arguments.map(t=>this.compose_argument(t,e));L(n,e,r)&&this.compose(e,t.styles)}break}case"keyframes":this.keyframes[t.name]||(this.keyframes[t.name]=(e=>`\n ${r(t.steps.map(t=>`\n ${t.name}{${r(t.styles.map(t=>this.compose_rule(t,e)))}}`))}`))}})}output(){Object.keys(this.rules).forEach((e,t)=>{if(Ee(e))this.styles.container+=`\n .container{${r(this.rules[e])}}`;else{let t=Se(e)?"host":"cells";this.styles[t]+=`\n ${e}{${r(this.rules[e])}}`}});let e=Object.keys(this.keyframes);return this.coords.forEach((t,n)=>{e.forEach(e=>{let r=this.compose_aname(e,t.count);this.styles.keyframes+=`\n ${function(e,t){return e?"function"==typeof t?t():t:""}(0==n,`@keyframes ${e}{${this.keyframes[e](t)}}`)}@keyframes ${r}{${this.keyframes[e](t)}}`})}),{props:this.props,styles:this.styles,grid:this.grid}}}function Le(e,t){let n=new Oe(e),r={};n.compose({x:1,y:1,count:1,context:{},grid:{x:1,y:1,count:1}});let{grid:i}=n.output();i&&(t=i),n.reset();for(let e=1,i=0;e<=t.x;++e)for(let l=1;l<=t.y;++l)n.compose({x:e,y:l,count:++i,grid:t,context:r});return n.output()}customElements.define("css-doodle",class extends HTMLElement{constructor(){super(),this.doodle=this.attachShadow({mode:"open"}),this.extra={get_custom_property_value:this.get_custom_property_value.bind(this)}}connectedCallback(){setTimeout(()=>{let e,t=this.getAttribute("use")||"";if(t&&(t=`@use:${t};`),!this.innerHTML.trim()&&!t)return!1;try{let n=O(t+this.innerHTML,this.extra);this.grid_size=q(this.getAttribute("grid")),(e=Le(n,this.grid_size)).grid&&(this.grid_size=e.grid),this.build_grid(e)}catch(e){this.innerHTML="",console.error(e&&e.message||"Error in css-doodle.")}})}get_custom_property_value(e){return getComputedStyle(this).getPropertyValue(e).trim().replace(/^\(|\)$/g,"")}build_grid(e){const{has_transition:t,has_animation:n}=e.props,{keyframes:r,host:i,container:l,cells:s}=e.styles;this.doodle.innerHTML=`\n<style>${this.style_basic()}</style><style class="style-keyframes">${r}</style><style class="style-container">${this.style_size()}${i}${l}</style><style class="style-cells">${t||n?"":s}</style><div class="container">${this.html_cells()}</div>`,(t||n)&&setTimeout(()=>{this.set_style(".style-cells",s)},50)}inherit_props(e){return me(/grid/).map(e=>`${e}:inherit;`).join("")}style_basic(){return`\n:host{display:block;visibility:visible;width:1em;height:1em;}.container{position:relative;width:100%;height:100%;display:grid;${this.inherit_props()}}.cell{position:relative;line-height:1;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}`}style_size(){let{x:e,y:t}=this.grid_size;return`\n:host{grid-template-rows:repeat(${e}, 1fr);grid-template-columns:repeat(${t}, 1fr);}`}html_cells(){return'<div class="cell"></div>'.repeat(this.grid_size.count)}set_style(e,t){const n=this.shadowRoot.querySelector(e);n&&(n.styleSheet?n.styleSheet.cssText=t:n.innerHTML=t)}update(e){let t=this.getAttribute("use")||"";t&&(t=`@use:${t};`),e||(e=this.innerHTML),this.innerHTML=e,this.grid_size||(this.grid_size=q(this.getAttribute("grid")));const n=Le(O(t+e,this.extra),this.grid_size);if(n.grid){let{x:e,y:t}=n.grid;if(this.grid_size.x!==e||this.grid_size.y!==t)return Object.assign(this.grid_size,n.grid),this.build_grid(n);Object.assign(this.grid_size,n.grid)}else{let n=q(this.getAttribute("grid")),{x:r,y:i}=n;if(this.grid_size.x!==r||this.grid_size.y!==i)return Object.assign(this.grid_size,n),this.build_grid(Le(O(t+e,this.extra),this.grid_size))}this.set_style(".style-keyframes",n.styles.keyframes),this.set_style(".style-container",this.style_size()+n.styles.host+n.styles.container),this.set_style(".style-cells",n.styles.cells)}get grid(){return Object.assign({},this.grid_size)}set grid(e){this.setAttribute("grid",e),this.connectedCallback()}get use(){return this.getAttribute("use")}set use(e){this.setAttribute("use",e),this.connectedCallback()}static get observedAttributes(){return["grid","use"]}attributeChangedCallback(e,t,n){if(t==n)return!1;"grid"==e&&t&&(this.grid=n),"use"==e&&t&&(this.use=n)}})});