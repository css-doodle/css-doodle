!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function iterator(e){var t=0,n=1,r=1;return{curr:(n=0)=>e[t+n],end:()=>e.length<=t,info:()=>({index:t,col:n,line:r}),index:e=>void 0===e?t:t=e,next:()=>{var s=e[t++];return"\n"==s?(r++,n=0):n++,s}}}function throw_error(e,{col:t,line:n}){throw new Error(`(at line ${n}, column ${t}) ${e}`)}function get_text_value(e){return e.trim().length?is.number(+e)?+e:e.trim():e}function skip_block(e){var[t,n]=[e.curr(),e.curr()],r=is.close_bracket_of(n);for(e.next();!e.end();){if(r(n=e.curr())){t+=n;break}is.open_bracket(n)?t+=skip_block(e):t+=n,e.next()}return t}function read_word(e,t){for(var n=e.index(),r="";!e.end();){var s=e.next();if(is.white_space(s))break;r+=s}return t&&e.index(n),r}function read_step(e){for(var t,n=Tokens.step();!e.end()&&"}"!=(t=e.curr());)if(is.white_space(t))e.next();else{if(n.name.length){if(n.styles.push(read_rule(e)),"}"==e.curr())break}else n.name=read_selector(e);e.next()}return n}function read_steps(e){const t=[];for(var n;!e.end()&&"}"!=(n=e.curr());)is.white_space(n)?e.next():(t.push(read_step(e)),e.next());return t}function read_keyframes(e){for(var t,n=Tokens.keyframes();!e.end()&&"}"!=(t=e.curr());)if(n.name.length){if("{"==t){e.next(),n.steps=read_steps(e);break}e.next()}else if(read_word(e),n.name=read_word(e),"{"==n.name){throw_error("missing keyframes name",e.info());break}return n}function read_comments(e,t={}){var n=Tokens.comment(),r=e.curr();for("#"!=r&&e.next(),e.next();!e.end()&&("*"!=(r=e.curr())||"/"!=e.curr(1));){if(n.value+=r,r=e.curr(),t.inline){if("\n"==r)return n}else if("*"==r&&"/"==e.curr(1))break;n.value+=r,e.next()}return e.next(),e.next(),n}function read_property(e){for(var t,n="";!e.end()&&":"!=(t=e.curr());)/[a-zA-Z\-]/.test(t)?is.white_space(t)||(n+=t):throw_error("Syntax error:Bad property name.",e.info()),e.next();return n}function read_quote_block(e,t){var n,r="";for(e.next();!e.end();){if((n=e.curr())==t){if("\\"!==e.curr(-1))break;r+=n}else r+=n;e.next()}return r}function read_arguments(e){for(var t,n=[],r=[],s="";!e.end();){if(is.open_bracket(t=e.curr()))s+=skip_block(e);else if(/['"]/.test(t))s+=read_quote_block(e,t);else if("@"==t)r.length||(s=s.trimLeft()),s.length&&(r.push(Tokens.text(s)),s=""),r.push(read_func(e));else if(/[,)]/.test(t)){if(s.length&&(r.length?(s=s.trimRight()).length&&r.push(Tokens.text(s)):r.push(Tokens.text(get_text_value(s)))),n.push(r.slice()),[r,s]=[[],""],")"==t)break}else s+=t;e.next()}return n}function read_func(e){for(var t,n=Tokens.func(),r="";!e.end()&&")"!=(t=e.curr());){if("("==t){e.next(),n.name=r,n.arguments=read_arguments(e);break}r+=t,e.next()}return n}function read_value(e){var t,n=Tokens.text();const r=[];for(;!e.end();)if("\n"!=(t=e.curr())){if(/[;}]/.test(t)){n.value.length&&r.push(n),n=Tokens.text();break}"@"==t?(n.value.length&&r.push(n),n=Tokens.text(),r.push(read_func(e))):is.white_space(t)&&is.white_space(e.curr(-1))||(":"==t&&throw_error("Syntax error:Bad property name.",e.info()),n.value+=t),e.next()}else e.next();return n.value.length&&r.push(n),r.length&&r[0].value&&(r[0].value=r[0].value.trimLeft()),r}function read_selector(e){for(var t,n="";!e.end()&&"{"!=(t=e.curr());)is.white_space(t)||(n+=t),e.next();return n}function read_cond_selector(e){for(var t,n={name:"",arguments:[]};!e.end();){if("("==(t=e.curr()))e.next(),n.arguments=read_arguments(e);else{if(/[){]/.test(t))break;is.white_space(t)||(n.name+=t)}e.next()}return n}function read_psuedo(e){for(var t,n=Tokens.psuedo();!e.end()&&"}"!=(t=e.curr());)if(is.white_space(t))e.next();else{if(n.selector){if(n.styles.push(read_rule(e)),"}"==e.curr())break}else n.selector=read_selector(e);e.next()}return n}function read_rule(e){for(var t=Tokens.rule();!e.end()&&";"!=e.curr();){if(t.property.length){t.value=read_value(e);break}t.property=read_property(e),e.next()}return t}function read_cond(e){for(var t,n=Tokens.cond();!e.end()&&"}"!=(t=e.curr());){if(n.name.length){if(":"==t){var r=read_psuedo(e);r.selector&&n.styles.push(r)}else if("@"==t)n.styles.push(read_cond(e));else if(!is.white_space(t)){var s=read_rule(e);if(s.property&&n.styles.push(s),"}"==e.curr())break}}else Object.assign(n,read_cond_selector(e));e.next()}return n}function parse(e){const t=iterator(e),n=[];for(;!t.end();){var r=t.curr();if(is.white_space(r))t.next();else{if("/"==r&&"*"==t.curr(1))n.push(read_comments(t));else if("#"==r||"/"==r&&"/"==t.curr(1))n.push(read_comments(t,{inline:!0}));else if(":"==r){var s=read_psuedo(t);s.selector&&n.push(s)}else if("@"==r)if("@keyframes"===read_word(t,!0)){var o=read_keyframes(t);n.push(o)}else{var i=read_cond(t);i.name.length&&n.push(i)}else if(!is.white_space(r)){var a=read_rule(t);a.property&&n.push(a)}t.next()}}return n}function values(e){return Array.isArray(e)?e:Object.keys(e).map(t=>e[t])}function apply_args(e,...t){return t.reduce((e,t)=>e.apply(null,values(t)),e)}function join_line(e){return(e||[]).join("\n")}function make_array(e){return Array.isArray(e)?e:[e]}function minmax(e,t,n){return Math.max(t,Math.min(n,e))}function prefix(e){return`-webkit-${e}${e}`}function only_if(e,t){return e?t:""}function memo(e,t){return function(...n){let r=e+n.join("-");return store[r]?store[r]:store[r]=t.apply(null,n)}}function random(...e){let t=e.reduce((e,t)=>e.concat(t),[]);return t[Math.floor(Math.random()*t.length)]}function range(e,t,n){let r=0,s=e=>e>0&&e<1?.1:1,o=arguments.length;1==o&&([e,t]=[s(e),e]),o<3&&(n=s(e));let i=[];for(;(n>0&&e<t||n<0&&e>t)&&(i.push(e),e+=n,!(r++>=1e3)););return i}function unitify(e){return function(...t){let n=get_unit(t[0]);return n?(t=t.map(remove_unit),add_unit(e,n).apply(null,t)):e.apply(null,t)}}function add_unit(e,t){return function(...n){n=n.map(remove_unit);let r=e.apply(null,n);return t&&(r=r.map(e=>e+t)),r}}function get_unit(e){if(!e)return"";let t=/(%|cm|fr|rem|em|ex|in|mm|pc|pt|px|vh|vw|vmax|vmin|deg|grad|rad|turn|ms|s)$/,n="".trim.call(e).match(t);return n?n[0]:""}function remove_unit(e){let t=get_unit(e);return t?+e.replace(t,""):e}function parse_size(e){let[t,n]=(e+"").replace(/\s+/g,"").replace(/[,，xX]+/,"x").split("x").map(Number);const r=1==t||1==n?total:max,s={x:minmax(t||min,1,r),y:minmax(n||t||min,1,r)};return Object.assign({},s,{count:s.x*s.y})}function nth(e,t,n){return e=>e==n}function at(e,t){return(n,r)=>e==n&&t==r}function row(e,t,n){return t=>/^(even|odd)$/.test(t)?is$1[t](e-1):t==e}function col(e,t,n){return e=>/^(even|odd)$/.test(e)?is$1[e](t-1):e==t}function even(e,t,n){return e=>is$1.even(n-1)}function odd(e,t,n){return e=>is$1.odd(n-1)}function random$1(){return e=>Math.random()<.5}function polygon(e,t){"function"==typeof arguments[0]&&(t=e,e={}),t||(t=(e=>[cos(e),sin(e)]));for(var n=e.split||120,r=e.scale||1,s=DEG*(e.start||0),o=e.deg?e.deg*DEG:PI/(n/2),i=[],a=0;a<n;++a){var u=s+o*a,[c,l]=t(u);i.push(50*c*r+50+"% "+(50*l*r+50)+"%")}return`polygon(${i.join(",")})`}function rotate(e,t,n){var r=DEG*n;return[e*cos(r)-t*sin(r),t*cos(r)+e*sin(r)]}function circle(){return"circle(49%)"}function triangle(){return polygon({split:3,start:-90},e=>[1.1*cos(e),1.1*sin(e)+.2])}function rhombus(){return polygon({split:4})}function pentagon(){return polygon({split:5,start:54})}function hexagon(){return polygon({split:6,start:30})}function heptagon(){return polygon({split:7,start:-90})}function octagon(){return polygon({split:8,start:22.5})}function star(){return polygon({split:5,start:54,deg:144})}function diamond(){return"polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)"}function cross(){return`polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )`}function clover(e=3){return 4==(e=minmax(e,3,5))&&(e=2),polygon({split:240},t=>{var n=cos(e*t)*cos(t),r=cos(e*t)*sin(t);return 3==e&&(n-=.2),2==e&&(n/=1.1,r/=1.1),[n,r]})}function hypocycloid(e=3){var t=1-(e=minmax(e,3,6));return polygon({scale:1/e},n=>{var r=t*cos(n)+cos(t*(n-PI)),s=t*sin(n)+sin(t*(n-PI));return 3==e&&(r=1.1*r-.6,s*=1.1),[r,s]})}function astroid(){return hypocycloid(4)}function infinity(){return polygon(e=>{var t=.7*sqrt(2)*cos(e),n=pow(sin(e),2)+1;return[t/n,t*sin(e)/n]})}function heart(){return polygon(e=>rotate(1.2*(.75*pow(sin(e),3)),1.1*(cos(1*e)*(13/18)-cos(2*e)*(5/18)-cos(3*e)/18-cos(4*e)/18+.2),180))}function bean(){return polygon(e=>{var[t,n]=[pow(sin(e),3),pow(cos(e),3)];return rotate((t+n)*cos(e)*1.3-.45,(t+n)*sin(e)*1.3-.45,-90)})}function bicorn(){return polygon(e=>rotate(cos(e),pow(sin(e),2)/(2+sin(e))-.5,180))}function pear(){return polygon(e=>[sin(e),(1+sin(e))*cos(e)/1.4])}function fish(){return polygon(e=>[cos(e)-pow(sin(e),2)/sqrt(2),sin(2*e)/2])}function whale(){return polygon({split:240},e=>{var t=3.4*(pow(sin(e),2)-.5)*cos(e);return rotate(cos(e)*t+.75,sin(e)*t*1.2,180)})}function bud(e=3){return e=minmax(e,3,10),polygon({split:240},t=>[(1+.2*cos(e*t))*cos(t)*.8,(1+.2*cos(e*t))*sin(t)*.8])}function index(e,t,n){return e=>n}function row$1(e,t,n){return t=>e}function col$1(e,t,n){return e=>t}function any(){return function(...e){return random.apply(null,e)}}function pick(){return any.apply(null,arguments)}function rand(){return function(...e){return random(memo("range",unitify(range)).apply(null,e))}}function shape(e,t,n){return memo("shape",function(e,...t){if(e&&(e=e.trim(),shapes[e]))return shapes[e].apply(null,t)})}function generator(e,t){for(var n=new Rules(e),r=1,s=0;r<=t.x;++r)for(var o=1;o<=t.y;++o)n.compose({x:r,y:o,count:++s});return n.output()}const Tokens={func:(e="")=>({type:"func",name:e,arguments:[]}),argument:()=>({type:"argument",value:[]}),text:(e="")=>({type:"text",value:e}),comment:e=>({type:"comment",value:e}),psuedo:(e="")=>({type:"psuedo",selector:e,styles:[]}),cond:(e="")=>({type:"cond",name:e,styles:[],arguments:[]}),rule:(e="")=>({type:"rule",property:e,value:[]}),keyframes:(e="")=>({type:"keyframes",name:e,steps:[]}),step:(e="")=>({type:"step",name:e,styles:[]})},bracket_pair={"(":")","[":"]","{":"}"},is={white_space:e=>/[\s\n\t]/.test(e),open_bracket:e=>bracket_pair.hasOwnProperty(e),close_bracket_of(e){var t=bracket_pair[e];return e=>e==t},number:e=>!isNaN(e)},store={},[min,max,total]=[1,16,256],is$1={even:e=>!!(e%2),odd:e=>!(e%2)};var cond={nth:nth,at:at,row:row,col:col,even:even,odd:odd,random:random$1};const{cos:cos,sin:sin,sqrt:sqrt,pow:pow,PI:PI}=Math,DEG=PI/180;var shapes={circle:circle,triangle:triangle,rhombus:rhombus,pentagon:pentagon,hexagon:hexagon,heptagon:heptagon,octagon:octagon,star:star,diamond:diamond,cross:cross,clover:clover,hypocycloid:hypocycloid,astroid:astroid,infinity:infinity,heart:heart,bean:bean,bicorn:bicorn,pear:pear,fish:fish,whale:whale,bud:bud},func={index:index,row:row$1,col:col$1,any:any,pick:pick,rand:rand,shape:shape},math=Object.getOwnPropertyNames(Math).reduce((expose,n)=>(expose[n]=function(){return function(...args){return"number"==typeof Math[n]?Math[n]:Math[n].apply(null,args.map(eval))}},expose),{});const reg_size=/[,，\/\s]+\s*/;var shortcuts={["size"](e){var[t,n=t]=e.split(reg_size);return`width:${t};height:${n};`},["min-size"](e){var[t,n=t]=e.split(reg_size);return`min-width:${t};min-height:${n};`},["max-size"](e){var[t,n=t]=e.split(reg_size);return`max-width:${t};max-height:${n};`},["place-absolute"]:e=>"center"!==e?e:`\n position:absolute;top:0;bottom:0;left:0;right:0;margin:auto !important;`};class Rules{constructor(e){this.tokens=e,this.rules={},this.props={},this.keyframes={},this.styles={host:"",container:"",cells:"",keyframes:""}}add_rule(e,t){var n=this.rules[e];n||(n=this.rules[e]=[]),n.push.apply(n,make_array(t))}pick_func(e){return func[e]||math[e]}compose_aname(...e){return e.join("-")}compose_selector(e,t=""){return`.cell:nth-of-type(${e})${t}`}compose_argument(e,t){var n=e.map(e=>{if("text"==e.type)return e.value;if("func"==e.type){var n=this.pick_func(e.name.substr(1));if(n){var r=e.arguments.map(e=>this.compose_argument(e,t));return apply_args(n,t,r)}}});return n.length>2?n.join(""):n[0]}compose_value(e,t){return e.reduce((e,n)=>{switch(n.type){case"text":e+=n.value;break;case"func":var r=this.pick_func(n.name.substr(1));if(r){var s=n.arguments.map(e=>this.compose_argument(e,t));e+=apply_args(r,t,s)}}return e},"")}compose_rule(e,t){var n=e.property,r=this.compose_value(e.value,t),s=`${n}:${r};`;if("transition"==n&&(this.props.has_transition=!0),"clip-path"==n&&(s=prefix(s),s+=";overflow:hidden;"),/^animation(\-name)?$/.test(n)&&(this.props.has_animation=!0,t.count>1)){var{count:o}=t;switch(n){case"animation-name":s=`${n}:${this.compose_aname(r,o)};`;break;case"animation":var i=(r||"").split(/\s+/);i[0]=this.compose_aname(i[0],o),s=`${n}:${i.join(" ")};`}}return shortcuts[n]&&(s=shortcuts[n](r)),s}compose(e,t){(t||this.tokens).forEach((t,n)=>{if(t.skip)return!1;switch(t.type){case"rule":this.add_rule(this.compose_selector(e.count),this.compose_rule(t,e));break;case"psuedo":t.selector.startsWith(":doodle")&&(t.selector=t.selector.replace(/^\:+doodle/,":host"));var r=/^\:(host|container|parent)/.test(t.selector);r&&(t.skip=!0);var s=t.styles.map(t=>this.compose_rule(t,e)),o=r?t.selector:this.compose_selector(e.count,t.selector);this.add_rule(o,s);break;case"cond":var i=cond[t.name.substr(1)];if(i){var a=t.arguments.map(t=>this.compose_argument(t,e));apply_args(i,e,a)&&this.compose(e,t.styles)}break;case"keyframes":this.keyframes[t.name]||(this.keyframes[t.name]=(()=>`\n ${join_line(t.steps.map(t=>`\n ${t.name}{${join_line(t.styles.map(t=>this.compose_rule(t,e)))}}`))}`))}})}output(){return Object.keys(this.rules).forEach((e,t)=>{if(/^\:(container|parent)/.test(e))this.styles.container+=`\n .container{${join_line(this.rules[e])}}`;else{var n=e.startsWith(":host")?"host":"cells";this.styles[n]+=`\n ${e}{${join_line(this.rules[e])}}`}Object.keys(this.keyframes).forEach(e=>{var n=this.compose_aname(e,t+1);this.styles.keyframes+=`\n ${only_if(0==t,`@keyframes ${e}{${this.keyframes[e]()}}`)}@keyframes ${n}{${this.keyframes[e]()}}`})}),{props:this.props,styles:this.styles}}}const basic=`\n:host{display:block;visibility:visible;width:1em;height:1em;}.container{position:relative;width:100%;height:100%;display:grid;}.cell{position:relative;line-height:1;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}`;class Doodle extends HTMLElement{constructor(){super(),this.doodle=this.attachShadow({mode:"open"})}connectedCallback(){setTimeout(()=>{if(!this.innerHTML.trim())return!1;let e;try{let t=parse(this.innerHTML);this.size=parse_size(this.getAttribute("grid")),e=generator(t,this.size)}catch(e){throw this.innerHTML="",new Error(e)}const{has_transition:t,has_animation:n}=e.props;this.doodle.innerHTML=`\n<style>${basic}</style><style class="style-keyframes">${e.styles.keyframes}</style><style class="style-container">${this.style_size()}${e.styles.host}${e.styles.container}</style><style class="style-cells">${t||n?"":e.styles.cells}</style><div class="container">${this.html_cells()}</div>`,(t||n)&&setTimeout(()=>{this.set_style(".style-cells",e.styles.cells)},50)})}style_size(){return`\n .container{grid-template-rows:repeat(${this.size.x}, 1fr);grid-template-columns:repeat(${this.size.y}, 1fr);}`}html_cells(){return'<div class="cell"></div>'.repeat(this.size.count)}set_style(e,t){const n=this.shadowRoot.querySelector(e);n&&(n.styleSheet?n.styleSheet.cssText=t:n.innerHTML=t)}update(e){if(!e)return!1;this.size||(this.size=parse_size(this.getAttribute("grid")));const t=generator(parse(e),this.size);this.set_style(".style-keyframes",t.styles.keyframes),this.set_style(".style-container",this.style_size()+t.styles.host+t.styles.container),this.set_style(".style-cells",t.styles.cells),this.innerHTML=e}refresh(){this.update(this.innerHTML)}get grid(){return Object.assign({},this.size)}set grid(e){this.setAttribute("grid",e),this.connectedCallback()}static get observedAttributes(){return["grid"]}attributeChangedCallback(e,t,n){"grid"==e&&t&&t!==n&&(this.grid=n)}}customElements.define("css-doodle",Doodle)});